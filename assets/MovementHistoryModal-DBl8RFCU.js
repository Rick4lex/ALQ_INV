import{u as D,r as l,j as e,T,A as y,P as $,M as E}from"./index-YKwopWJT.js";import{M as I}from"./Modal-D7kRee5V.js";const H=({isOpen:N,onClose:S,product:i})=>{var f;const{movements:p,handleSaveMovement:v,handleMultipleMovementsDelete:w}=D(),[a,k]=l.useState(((f=i.variants[0])==null?void 0:f.id)||""),[r,x]=l.useState(new Set),[c,g]=l.useState("Venta"),[m,h]=l.useState(1),[b,u]=l.useState("");l.useEffect(()=>{x(new Set),g("Venta"),h(1),u("")},[a]);const o=l.useMemo(()=>i.variants.find(s=>s.id===a),[i.variants,a]),d=l.useMemo(()=>(p[a]||[]).slice().reverse(),[p,a]),M=s=>{x(n=>{const t=new Set(n);return t.has(s)?t.delete(s):t.add(s),t})},C=s=>{s.target.checked?x(new Set(d.map(n=>n.id))):x(new Set)},A=()=>{r.size>0&&(w(a,Array.from(r)),x(new Set))},z=d.length>0&&r.size===d.length,V=s=>{if(s.preventDefault(),m===0||!a)return;const n=c==="Venta"?-Math.abs(m):c==="Stock"?Math.abs(m):m,t={timestamp:Date.now(),type:c,change:n,notes:b};c==="Venta"&&o&&(t.price=o.price,t.cost=o.cost),v(i.id,a,t),h(1),u("")},j={Venta:{icon:e.jsx(E,{size:16}),color:"bg-red-500/80"},Stock:{icon:e.jsx($,{size:16}),color:"bg-green-500/80"},Ajuste:{icon:e.jsx(y,{size:16}),color:"bg-yellow-500/80"},Inicial:{icon:e.jsx(y,{size:16}),color:"bg-blue-500/80"}};return e.jsx(I,{isOpen:N,onClose:S,title:`Movimientos de: ${i.title}`,size:"xl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 p-6",children:[e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Seleccionar Variante"}),e.jsx("select",{value:a,onChange:s=>k(s.target.value),className:"block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm",children:i.variants.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (Stock: ",s.stock,")"]},s.id))})]}),e.jsxs("form",{onSubmit:V,className:"p-4 bg-gray-900/50 rounded-lg space-y-4 border border-gray-700",children:[e.jsx("h3",{className:"font-semibold",children:"Registrar Movimiento"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Tipo"}),e.jsxs("select",{value:c,onChange:s=>g(s.target.value),className:"mt-1 w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-sm",children:[e.jsx("option",{value:"Venta",children:"Venta (-)"}),e.jsx("option",{value:"Stock",children:"AÃ±adir Stock (+)"}),e.jsx("option",{value:"Ajuste",children:"Ajuste (+/-)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:c==="Ajuste"?"Cantidad (+/-)":"Cantidad"}),e.jsx("input",{type:"number",value:m,onChange:s=>h(parseInt(s.target.value,10)||0),className:"mt-1 w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Notas (opcional)"}),e.jsx("input",{type:"text",value:b,onChange:s=>u(s.target.value),className:"mt-1 w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-sm"})]}),e.jsx("button",{type:"submit",className:"w-full py-2 px-4 bg-brand-purple hover:bg-purple-600 rounded-md transition-colors",children:"Guardar Movimiento"})]})]}),e.jsxs("div",{className:"md:col-span-2 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h3",{className:"font-semibold",children:["Historial de: ",e.jsx("span",{className:"text-purple-400",children:o==null?void 0:o.name})]}),d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pr-4",children:[e.jsx("label",{htmlFor:"select-all",className:"text-sm text-gray-400 cursor-pointer",children:"Seleccionar todo"}),e.jsx("input",{type:"checkbox",id:"select-all",checked:z,onChange:C,className:"form-checkbox h-4 w-4 rounded bg-gray-800 border-gray-600 text-purple-500 focus:ring-purple-600 cursor-pointer"})]})]}),e.jsx("div",{className:"flex-grow bg-gray-900/50 rounded-lg border border-gray-700 max-h-96 overflow-y-auto",children:d.length>0?e.jsx("ul",{className:"space-y-2 p-2",children:d.map(s=>{var n,t;return e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded transition-colors ${r.has(s.id)?"bg-purple-900/50":"bg-gray-800"}`,children:[e.jsx("input",{type:"checkbox",checked:r.has(s.id),onChange:()=>M(s.id),className:"form-checkbox h-5 w-5 rounded bg-gray-700 border-gray-600 text-purple-500 focus:ring-purple-600 cursor-pointer flex-shrink-0","aria-label":`Seleccionar movimiento ${s.id}`}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:`w-7 h-7 rounded-full flex items-center justify-center text-white ${((n=j[s.type])==null?void 0:n.color)||"bg-gray-500"}`,children:(t=j[s.type])==null?void 0:t.icon})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("p",{className:"font-semibold",children:[s.type," ",e.jsxs("span",{className:s.change>0?"text-green-400":"text-red-400",children:["(",s.change>0?`+${s.change}`:s.change,")"]})]}),e.jsxs("p",{className:"font-bold text-lg",children:["Stock Final: ",s.newStock]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:new Date(s.timestamp).toLocaleString("es-CO")}),s.notes&&e.jsxs("span",{className:"italic truncate",title:s.notes,children:['"',s.notes,'"']})]})]})]},s.id)})}):e.jsx("p",{className:"text-center text-gray-400 py-8",children:"No hay movimientos para esta variante."})}),r.size>0&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:A,className:"w-full flex items-center justify-center gap-2 py-2 px-4 bg-brand-red hover:bg-red-600 rounded-md transition-colors font-semibold",children:[e.jsx(T,{size:16}),"Eliminar ",r.size," Seleccionado(s)"]})})]})]})})};export{H as default};
