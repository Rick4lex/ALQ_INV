import{r as x,c as k,E as U,j as e,M as D,I,C as X,a as _,T as V,P}from"./index-CIMXU-Ls.js";const K=({isOpen:v,onClose:N,onSave:S,productToEdit:n,categories:h})=>{const[l,o]=x.useState(k()),[$,u]=x.useState(!1),[p,b]=x.useState(0),g=x.useRef(0);x.useEffect(()=>{if(n)o({...n,imageUrls:n.imageUrls&&n.imageUrls.length>0?n.imageUrls:[""],variants:n.variants.length>0?n.variants:[{...U,id:`new-variant-${Date.now()}`}],imageHint:n.imageHint||[]});else{const s=k();o({...s,category:h[0]||""})}u(!1),b(0)},[n,v,h]);const y=s=>{const{name:t,value:a}=s.target;o(r=>({...r,[t]:a}))},z=(s,t)=>{u(!1);const a=[...l.imageUrls];a[s]=t,o(r=>({...r,imageUrls:a}))},H=()=>o(s=>({...s,imageUrls:[...s.imageUrls,""]})),E=s=>{if(l.imageUrls.length<=1)return;const t=l.imageUrls.filter((a,r)=>r!==s);o(a=>({...a,imageUrls:t}))},c=(s,t,a)=>{const r=[...l.variants];let d={...r[s]};const f=d.name;if(t==="stock"||t==="price"||t==="cost"){const i=Number(a);d[t]=isNaN(i)||i<0?0:i}else if(t==="itemCount"){const i=Number(a),j=isNaN(i)?1:Math.max(1,i);d.itemCount=j,(f==="Único"||f==="Unidad"||/^Paquete de \d+$/.test(f))&&(d.name=j>1?`Paquete de ${j}`:"Unidad")}else d[t]=a;r[s]=d,o(i=>({...i,variants:r}))},M=()=>{const s={...U,id:`new-variant-${Date.now()}`,name:`Variante ${l.variants.length+1}`};o(t=>({...t,variants:[...t.variants,s]}))},R=s=>{if(l.variants.length<=1)return;const t=l.variants.filter((a,r)=>r!==s);o(a=>({...a,variants:t}))},F=s=>{if(s.preventDefault(),!l.title){alert("El título es obligatorio.");return}const t={...l,imageUrls:l.imageUrls.filter(a=>a&&a.trim()!==""),id:l.id||`${Date.now()}-${l.title.replace(/\s+/g,"-").toLowerCase()}`,variants:l.variants.map(a=>({...a,cost:a.cost||0,stock:a.stock>=0?a.stock:0,itemCount:a.itemCount||1})),imageHint:l.imageHint.filter(a=>a&&a.trim()!=="")};S(t)},m=l.imageUrls.filter(s=>s),w=()=>{u(!1),b(s=>s===0?m.length-1:s-1)},C=()=>{u(!1),b(s=>s===m.length-1?0:s+1)},L=s=>{g.current=s.touches[0].clientX},A=s=>{if(g.current===0)return;const t=s.touches[0].clientX,a=g.current-t;a>50&&(C(),g.current=0),a<-50&&(w(),g.current=0)};return e.jsx(D,{isOpen:v,onClose:N,title:n?"Editar Producto":"Añadir Producto",size:"xl",children:e.jsxs("form",{onSubmit:F,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsx("div",{className:"w-full h-48 bg-gray-700 rounded-lg overflow-hidden flex items-center justify-center relative group",onTouchStart:L,onTouchMove:A,children:m.length>0?e.jsxs(e.Fragment,{children:[$?e.jsxs("div",{className:"text-gray-500 flex flex-col items-center",children:[e.jsx(I,{size:40}),e.jsx("span",{children:"Error al Cargar"})]}):e.jsx("img",{src:m[p],alt:`Vista previa ${p+1}`,className:"h-full w-full object-cover",onError:()=>u(!0)},p),m.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:w,className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hidden md:block",children:e.jsx(X,{size:24})}),e.jsx("button",{type:"button",onClick:C,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hidden md:block",children:e.jsx(_,{size:24})}),e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5",children:m.map((s,t)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${t===p?"bg-white":"bg-white/50"}`},t))})]})]}):e.jsxs("div",{className:"text-gray-500 flex flex-col items-center",children:[e.jsx(I,{size:40}),e.jsx("span",{children:"Vista Previa"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"URLs de Imagen"}),e.jsx("div",{className:"overflow-x-auto pb-2 -mx-1 px-1",children:e.jsx("div",{className:"flex space-x-2",children:l.imageUrls.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 w-full sm:w-auto",children:[e.jsx("input",{type:"text",value:s,onChange:a=>z(t,a.target.value),placeholder:`URL ${t+1}`,className:"block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm"}),e.jsx("button",{type:"button",onClick:()=>E(t),disabled:l.imageUrls.length<=1,className:"p-2 rounded-full text-red-400 hover:bg-red-500/20 transition-colors disabled:opacity-50","aria-label":"Eliminar URL",children:e.jsx(V,{size:18})})]},t))})}),e.jsxs("button",{type:"button",onClick:H,className:"mt-2 flex items-center gap-2 text-sm text-purple-400 hover:text-purple-300",children:[e.jsx(P,{size:16}),"Añadir otra URL"]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-300",children:"Título (obligatorio)"}),e.jsx("input",{type:"text",name:"title",id:"title",required:!0,value:l.title,onChange:y,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-300",children:"Categoría"}),e.jsx("select",{name:"category",id:"category",value:l.category,onChange:y,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm",children:h.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"imageHint",className:"block text-sm font-medium text-gray-300",children:"Series / Hints (separados por coma)"}),e.jsx("input",{type:"text",id:"imageHint",value:(l.imageHint||[]).join(", "),onChange:s=>o(t=>({...t,imageHint:s.target.value.split(",").map(a=>a.trim())})),placeholder:"Ej: Kaiju No. 8, custom minifigure",className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"details",className:"block text-sm font-medium text-gray-300",children:"Detalles"}),e.jsx("textarea",{name:"details",id:"details",value:l.details,onChange:y,rows:2,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Variantes de Venta"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-2",children:l.variants.map((s,t)=>{const a=s.price&&s.itemCount&&s.itemCount>1?Math.round(s.price/s.itemCount):0;return e.jsxs("div",{className:"grid grid-cols-12 gap-x-3 gap-y-2 p-3 bg-gray-900/50 rounded-lg",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-3",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Nombre Variante"}),e.jsx("input",{type:"text",value:s.name,onChange:r=>c(t,"name",r.target.value),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-sm"})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"SKU"}),e.jsx("input",{type:"text",value:s.sku||"",onChange:r=>c(t,"sku",r.target.value),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-sm"})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-1",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Items"}),e.jsx("input",{type:"number",value:s.itemCount||1,min:"1",onChange:r=>c(t,"itemCount",r.target.value),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-sm"})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Precio"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-2 flex items-center text-gray-400 text-sm",children:"$"}),e.jsx("input",{type:"number",value:s.price||"",onChange:r=>c(t,"price",r.target.value),placeholder:"0",className:"w-full bg-gray-700 border-gray-600 rounded py-1 pl-6 pr-2 text-sm"})]}),a>0&&e.jsxs("span",{className:"text-xs text-green-400/80",children:["($",a.toLocaleString("es-CO")," c/u)"]})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Costo"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-2 flex items-center text-gray-400 text-sm",children:"$"}),e.jsx("input",{type:"number",value:s.cost||"",onChange:r=>c(t,"cost",r.target.value),placeholder:"0",className:"w-full bg-gray-700 border-gray-600 rounded py-1 pl-6 pr-2 text-sm"})]})]}),e.jsxs("div",{className:"col-span-6 sm:col-span-1",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Stock"}),e.jsx("input",{type:"number",value:s.stock,min:"0",onChange:r=>c(t,"stock",r.target.value),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-sm"})]}),e.jsx("div",{className:"col-span-12 sm:col-span-1 flex items-end justify-end",children:e.jsx("button",{type:"button",onClick:()=>R(t),disabled:l.variants.length<=1,className:"p-2 rounded-full text-red-400 hover:bg-red-500/20 disabled:opacity-50","aria-label":"Eliminar Variante",children:e.jsx(V,{size:18})})})]},s.id)})}),e.jsxs("button",{type:"button",onClick:M,className:"mt-2 flex items-center gap-2 text-sm text-purple-400 hover:text-purple-300",children:[e.jsx(P,{size:16}),"Añadir Variante"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:N,className:"py-2 px-4 bg-gray-600 hover:bg-gray-500 rounded-md transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"py-2 px-4 bg-brand-purple hover:bg-purple-600 rounded-md transition-colors",children:"Guardar"})]})]})})};export{K as default};
