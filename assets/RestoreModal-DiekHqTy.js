import{r as n,j as e,w as P,X as I,s as A}from"./index-YKwopWJT.js";import{M as B}from"./Modal-D7kRee5V.js";import{C as O}from"./cloud-upload-B4RycofI.js";import{T}from"./triangle-alert-DDjViyo7.js";const J=({isOpen:w,onClose:k,onRestore:D})=>{const[r,d]=n.useState(null),[g,t]=n.useState(""),[C,l]=n.useState(!1),[u,o]=n.useState(null),[c,i]=n.useState(null),[p,m]=n.useState(!1),h=()=>{d(null),t(""),l(!1),o(null),i(null),m(!1)},f=()=>{h(),k()},j=s=>{if(!s)return;if(s.type!=="application/json"&&!s.name.endsWith(".json")){t("Por favor, selecciona un archivo .json válido."),d(null),o(null),i(null);return}d(s),t("");const x=new FileReader;x.onload=S=>{var b,v,y;try{const N=(b=S.target)==null?void 0:b.result,a=JSON.parse(N);if(!a.products||!a.preferences)throw new Error("El archivo no parece ser un backup válido.");const F=a.preferences.key?"Fecha Desconocida":new Date(((y=(v=a.auditLog)==null?void 0:v[0])==null?void 0:y.timestamp)||Date.now()).toLocaleDateString("es-CO");o(a),i({products:a.products.length,movements:Object.values(a.movements||{}).flat().length,date:F})}catch{t("Error al procesar el archivo. Asegúrate de que es un archivo de respaldo válido."),o(null),i(null)}},x.onerror=()=>t("Error al leer el archivo."),x.readAsText(s)},E=s=>{s.preventDefault(),s.stopPropagation(),l(!1),j(s.dataTransfer.files?s.dataTransfer.files[0]:null)},R=async()=>{if(u){m(!0);try{await D(u)}catch{t("Ocurrió un error inesperado durante la restauración."),m(!1)}}};return e.jsx(B,{isOpen:w,onClose:f,title:"Restaurar desde Backup",children:e.jsxs("div",{className:"p-6 space-y-4",children:[c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx(P,{size:24,className:"text-purple-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-white truncate",title:r==null?void 0:r.name,children:r==null?void 0:r.name})]}),e.jsx("button",{onClick:h,className:"p-1 rounded-full text-gray-400 hover:bg-gray-600 hover:text-white",children:e.jsx(I,{size:16})})]}),e.jsxs("div",{className:"p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Resumen del Backup"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-300",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-gray-400",children:"Fecha del Backup:"})," ",c.date]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-gray-400",children:"Productos a restaurar:"})," ",c.products]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-gray-400",children:"Registros de movimiento:"})," ",c.movements]})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 text-sm bg-yellow-900/30 text-yellow-300 rounded-lg border border-yellow-700/50",children:[e.jsx(T,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("p",{children:[e.jsx("span",{className:"font-bold",children:"Advertencia:"})," Esta acción sobreescribirá todos los datos actuales. Es irreversible."]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-300",children:"Selecciona o arrastra tu archivo de respaldo (.json)."}),e.jsxs("div",{onDragEnter:s=>{s.preventDefault(),s.stopPropagation(),l(!0)},onDragLeave:s=>{s.preventDefault(),s.stopPropagation(),l(!1)},onDragOver:s=>{s.preventDefault(),s.stopPropagation()},onDrop:E,className:`flex flex-col items-center justify-center p-8 border-2 border-dashed rounded-lg cursor-pointer transition-colors ${C?"border-purple-400 bg-purple-900/30":"border-gray-600 hover:border-gray-500"}`,onClick:()=>{var s;return(s=document.getElementById("backupFileInput"))==null?void 0:s.click()},children:[e.jsx(O,{size:40,className:"text-gray-400 mb-2"}),e.jsx("span",{className:"text-gray-300",children:"Arrastra y suelta el archivo aquí"}),e.jsx("span",{className:"text-sm text-gray-500",children:"o haz clic para seleccionar"}),e.jsx("input",{id:"backupFileInput",type:"file",accept:".json,application/json",className:"hidden",onChange:s=>j(s.target.files?s.target.files[0]:null)})]})]}),g&&e.jsx("p",{className:"text-red-400 text-sm",children:g}),e.jsxs("div",{className:"flex justify-end gap-4 pt-2",children:[e.jsx("button",{onClick:f,className:"py-2 px-4 bg-gray-600 hover:bg-gray-500 rounded-md transition-colors",disabled:p,children:"Cancelar"}),e.jsx("button",{onClick:R,disabled:!u||p,className:"py-2 px-4 bg-brand-green hover:bg-green-600 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"animate-spin h-5 w-5"})," Restaurando..."]}):"Confirmar y Restaurar"})]})]})})};export{J as default};
