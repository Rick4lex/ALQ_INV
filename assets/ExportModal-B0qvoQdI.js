import{b as R,j as e,S as B,f as G,r as x,u as J,L as k,g as N,t as q,d as K,e as H,h as W,i as Y,D as Q,k as X}from"./index-YKwopWJT.js";import{M as Z}from"./Modal-D7kRee5V.js";import{C as ee}from"./copy-DwBrr6nD.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=R("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),te=({products:g})=>e.jsxs("div",{className:"font-sans text-gray-800",children:[e.jsxs("header",{className:"text-center mb-8 border-b-2 border-purple-600 pb-4",children:[e.jsx(B,{className:"mx-auto h-12 w-12 text-purple-600"}),e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mt-2",children:"Alquima Mizu"}),e.jsx("p",{className:"text-lg text-purple-700",children:"Catálogo de Productos"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:g.map(c=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden flex flex-col shadow-md",children:[e.jsx("div",{className:"w-full h-40 bg-gray-100 flex items-center justify-center",children:c.imageUrls[0]&&e.jsx("img",{src:c.imageUrls[0],alt:c.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-3 flex flex-col flex-grow",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600 font-semibold uppercase",children:c.category}),e.jsx("h3",{className:"text-base font-bold text-gray-900 mt-1",children:c.title}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 flex-grow",children:c.details})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700 font-medium text-sm",children:"Precio:"}),e.jsx("span",{className:"font-semibold text-green-700 text-base",children:G(c,{onlyAvailable:!0})})]})})]})]},c.id))}),e.jsxs("footer",{className:"text-center mt-12 pt-4 border-t border-gray-300",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Catálogo generado el ",new Date().toLocaleDateString("es-ES")]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Alquima Mizu - Todos los derechos reservados."})]})]});function L(g,c){const[a,d]=x.useState(()=>{try{const o=window.localStorage.getItem(g);return o?JSON.parse(o):c}catch(o){return console.log(o),c}});return[a,o=>{try{const f=o instanceof Function?o(a):o;d(f),window.localStorage.setItem(g,JSON.stringify(f))}catch(f){console.log(f)}}]}const re={json:"Exportar a JSON",markdown:"Exportar a Markdown",catalog:"Vista Previa del Catálogo",csv:"Exportar a CSV / Excel"},le=({isOpen:g,onClose:c,format:a})=>{const{products:d,ignoredProductIds:h}=J(),[o,f]=x.useState("Todas"),[v,A]=L(k.OMITTED_HINTS,[]),[j,b]=L(k.CATALOG_SELECTED_HINTS,[]),[y,S]=x.useState(""),[M,E]=x.useState(!1),p=x.useMemo(()=>Array.from(new Set((d||[]).flatMap(t=>t.imageHint||[]).filter(Boolean))),[d]);x.useEffect(()=>{g&&a==="catalog"&&localStorage.getItem(k.CATALOG_SELECTED_HINTS)===null&&b(p)},[g,a,p,b]);const C=x.useMemo(()=>{if(!d)return[];const t=d.filter(r=>r.variants.some(n=>n.stock>0)&&!h.includes(r.id));return a==="markdown"?o==="Todas"?t:t.filter(r=>r.imageHint&&r.imageHint.includes(o)):a==="catalog"?j.length===0?[]:t.filter(r=>(r.imageHint||[]).some(n=>j.includes(n))):t},[d,h,a,o,j]),T=x.useMemo(()=>d?d.filter(t=>!h.includes(t.id)):[],[d,h]);x.useEffect(()=>{if(!(!g||!d))if(a==="json"){const n={placeholderImages:[...d].sort((s,l)=>{const m=N(s),i=N(l);return m===-1&&i!==-1?-1:m!==-1&&i===-1?1:m===-1&&i===-1?s.title.localeCompare(l.title):m-i}).filter(s=>s.id==="banner"?!0:s.imageUrls&&s.imageUrls.length>0&&s.imageUrls[0].trim()!=="").map(q)};S(JSON.stringify(n,null,2))}else if(a==="markdown"){let t="";const r=C.reduce((s,l)=>((l.imageHint&&l.imageHint.length>0?l.imageHint:["Otros"]).forEach(i=>{s[i]||(s[i]=[]),s[i].push(l)}),s),{}),n=s=>s.sort((l,m)=>{const i=N(l),u=N(m);return i===-1&&u!==-1?-1:i!==-1&&u===-1?1:i===-1&&u===-1?l.title.localeCompare(m.title):i-u}).map(l=>{const m=l.variants.filter(u=>u.stock>0&&u.price&&u.price>0);if(m.length===0)return`- ${l.title}: Agotado`;let i=`- ${l.title}:`;if(m.length===1)i+=` ${H(m[0],{markdown:!0})}`;else{const u=m.sort((w,_)=>w.price-_.price).map(w=>`  * ${w.name}: ${H(w,{markdown:!0})}`).join(`
`);i+=`
${u}`}return i}).join(`
`);o!=="Todas"?t=`*${o}*
`+n(r[o]||[]):t=Object.entries(r).sort(([s],[l])=>s.localeCompare(l)).filter(([s])=>!v.includes(s)).map(([s,l])=>`
*${s}*
${n(l)}`).join(`
`),S(t.trim())}else a==="csv"&&S(K(T))},[g,a,d,C,h,o,v,T]);const I=x.useCallback(()=>{navigator.clipboard.writeText(y).then(()=>{E(!0),setTimeout(()=>E(!1),2e3)})},[y]),z=()=>window.print(),O=()=>{const t=new Blob([y],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=`alquima-mizu-export-${new Date().toISOString().slice(0,10)}.csv`,n.click(),URL.revokeObjectURL(r),n.remove()},D=t=>A(r=>r.includes(t)?r.filter(n=>n!==t):[...r,t]),F=t=>b(r=>r.includes(t)?r.filter(n=>n!==t):[...r,t]),$=a==="markdown"&&p.length>0,U=a==="catalog"&&p.length>0,V=()=>{switch(a){case"catalog":return e.jsxs("div",{className:"bg-gray-700 w-full h-full overflow-auto p-4 md:p-8",children:[e.jsxs("div",{className:"no-print mx-auto max-w-4xl mb-4 space-y-4",children:[e.jsxs("button",{onClick:z,className:"flex items-center justify-center gap-2 w-full bg-brand-blue hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition-transform transform hover:scale-105",children:[e.jsx(X,{size:18}),e.jsx("span",{children:"Imprimir / Guardar como PDF"})]}),e.jsx("div",{className:"md:hidden p-3 text-center text-xs bg-yellow-900/50 text-yellow-300 rounded-lg border border-yellow-700",children:"Para una mejor experiencia de impresión, por favor usa una computadora. En móvil, puedes intentar usar la función de 'captura de pantalla con desplazamiento' de tu dispositivo."}),U&&e.jsxs("details",{className:"p-3 bg-gray-800/50 rounded-lg border border-gray-600",open:!0,children:[e.jsxs("summary",{className:"cursor-pointer font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(P,{size:16}),"Filtrar por Serie (selección múltiple)"]}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-sm",children:[e.jsx("button",{onClick:()=>b(p),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded",children:"Todos"}),e.jsx("button",{onClick:()=>b([]),className:"px-3 py-1 bg-gray-600 hover:bg-gray-500 rounded",children:"Ninguno"})]}),e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 max-h-40 overflow-y-auto",children:p.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm p-1 rounded hover:bg-gray-700/50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j.includes(t),onChange:()=>F(t),className:"form-checkbox h-4 w-4 rounded bg-gray-800 border-gray-600 text-purple-500 focus:ring-purple-600"}),t]},t))})]})]}),e.jsx("div",{id:"catalog-to-print",className:"bg-white text-black p-8 md:p-12 rounded-lg shadow-2xl max-w-4xl mx-auto my-8",children:e.jsx(te,{products:C})})]});case"csv":return e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("p",{className:"mb-6 text-gray-300",children:"Se generará un archivo CSV con todos los productos y sus variantes. Este archivo es compatible con Excel, Google Sheets y otras hojas de cálculo."}),e.jsxs("button",{onClick:O,className:"flex items-center justify-center gap-3 w-full max-w-xs mx-auto bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105 shadow-lg",children:[e.jsx(Q,{size:20}),"Descargar Archivo .csv"]})]});default:return e.jsxs("div",{className:"p-6",children:[$&&e.jsxs("div",{className:"no-print mb-4 p-3 bg-gray-700/50 rounded-lg border border-gray-600",children:[e.jsxs("label",{htmlFor:"hint-filter",className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-2",children:[e.jsx(P,{size:16}),"Filtrar por Serie (imageHint)"]}),e.jsx("select",{id:"hint-filter",value:o,onChange:t=>f(t.target.value),className:"block w-full bg-gray-900 border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm",children:["Todas",...p].map(t=>e.jsx("option",{value:t,children:t},t))})]}),a==="markdown"&&o==="Todas"&&p.length>1&&e.jsxs("details",{className:"no-print mb-4 text-sm",children:[e.jsxs("summary",{className:"cursor-pointer text-gray-400 hover:text-white flex items-center gap-1",children:[e.jsx(W,{size:16,className:"transition-transform transform details-open:rotate-180"}),"Omitir Series del Markdown"]}),e.jsx("div",{className:"mt-2 p-3 bg-gray-700/50 rounded-lg border border-gray-600 max-h-32 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:p.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:v.includes(t),onChange:()=>D(t),className:"form-checkbox h-4 w-4 rounded bg-gray-800 border-gray-600 text-purple-500 focus:ring-purple-600"}),t]},t))})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-sm p-4 rounded-lg overflow-auto max-h-96 border border-gray-700",children:e.jsx("code",{children:y})}),e.jsx("button",{onClick:I,className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded-md transition-colors",children:M?e.jsx(Y,{size:16,className:"text-green-400"}):e.jsx(ee,{size:16})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:a==="json"?"Listo para pegar en placeholder-images.json":"Formato optimizado para WhatsApp/Instagram."})]})}};return e.jsx(Z,{isOpen:g,onClose:c,title:re[a],size:a==="catalog"?"full":"lg",children:V()})};export{le as default};
